#zettels


> Data Race (–ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
> **Data race** ‚Äî —ç—Ç–æ –æ—à–∏–±–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∏–ª–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–æ–∑–Ω–∏–∫–∞—é—â–∞—è, –∫–æ–≥–¥–∞:
> 
> 1. –î–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–∞ **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π**;
> 2. **–•–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –ø–æ—Ç–æ–∫–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç** –≤ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é;
> 3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–¥–ª–µ–∂–∞—â–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Mutex`, –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã, –∫–∞–Ω–∞–ª—ã).
> 
> ‚ö†Ô∏è –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ **–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**, –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö, –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
> 
> ---
> 
> ### üîß –ü—Ä–∏–º–µ—Ä (Rust, –ø—Å–µ–≤–¥–æ–∫–æ–¥)
> ```rust
> let mut x = 0;
> 
> spawn thread_1 {
>     x = 1; // –∑–∞–ø–∏—Å—å
> }
> 
> spawn thread_2 {
>     println!("{x}"); // —á—Ç–µ–Ω–∏–µ
> }
> ```
> 
> –ë–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ **data race**. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Rust –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∫–æ–¥–µ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —Ç–∞–∫ —Å–¥–µ–ª–∞—Ç—å.
> 
> ---
> 
> ### üõ°Ô∏è –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è:
> - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Mutex**, **RwLock**, **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã** (`AtomicUsize` –∏ –¥—Ä.).
> - –í Rust –∏–∑–±–µ–≥–∞—Ç—å `unsafe`, –µ—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã.
> - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≥–æ–Ω–∫–∏ –≤ C/C++ —á–µ—Ä–µ–∑ **Sanitizer** (`-fsanitize=thread`) –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ (`Valgrind`, `ThreadSanitizer`).


> Data Races –≤ Python
> 
> –í Python –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–∂–µ –≤–æ–∑–º–æ–∂–Ω—ã, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ **GIL (Global Interpreter Lock)**.
> 
> ‚ùó –î–∞–∂–µ —Å GIL –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–æ–¥–µ `x += 1` ‚Äî **–Ω–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–µ**, –∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –≥–æ–Ω–∫–∞.
> 
> ---
> 
> ### üîß –ü—Ä–∏–º–µ—Ä –±–µ–∑ –∑–∞—â–∏—Ç—ã:
> ```python
> x = 0
> def inc(): x += 1  # –≥–æ–Ω–∫–∞!
> ```
> 
> ### ‚úÖ –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ `threading.Lock`:
> ```python
> lock = threading.Lock()
> with lock:
>     x += 1
> ```
> 
> ---
> 
> ### üõ°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
> - –ò—Å–ø–æ–ª—å–∑—É–π **Lock** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
> - –ò–ª–∏ **`queue.Queue`**, **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã**, **–º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ—Å—Ç—å** (`multiprocessing`).
> - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –±–µ–∑ GIL ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ—Å—Ç—å**, –Ω–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å.
